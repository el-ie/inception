#!/bin/bash

#if [ ! -e "/var/lib/mysql/$MYSQL_DATABASE" ]; then

#echo '$MYSQL_DATABASE'
#echo $MYSQL_DATABASE
#echo '$MYSQL_USER'
#echo $MYSQL_USER
#echo '$MYSQL_USER_PASS'
#echo $MYSQL_USER_PASS
#echo '$MYSQL_ROOT_PASS'
#echo $MYSQL_ROOT_PASS

#if [ ! -e "/var/lib/mysql/$MYSQL_DATABASE" ]; then

mkdir -p /run/mysqld && chown -R mysql:mysql /run/mysqld

#mysql_install_db --datadir=/var/lib/mysql

mysqld &

sleep 3

mysql -uroot -p$MYSQL_ROOT_PASS -e "CREATE DATABASE $MYSQL_DATABASE;"

mysql -uroot -p$MYSQL_ROOT_PASS -e "GRANT ALL PRIVILEGES ON *.* TO '$MYSQL_USER'@'%' IDENTIFIED BY '$MYSQL_USER_PASS' WITH GRANT OPTION;"

mysql -uroot -p$MYSQL_ROOT_PASS -e "SET PASSWORD FOR 'root'@'localhost' = PASSWORD('$MYSQL_ROOT_PASS');"

echo "Set pass for root"

mysql -uroot -p$MYSQL_ROOT_PASS -e "FLUSH PRIVILEGES;"

echo "Done"

mysqladmin -uroot -p$MYSQL_ROOT_PASS shutdown

exec mysqld

#else
#	echo database is already present, creation step skipped
#fi

##########################################3
#if [ ! -e "/var/lib/mysql/$MYSQL_DATABASE" ]; then
#
#mysql_install_db --datadir=/var/lib/mysql
#
#mysqld_safe &
#
#sleep 3
#
#mysql -e "CREATE DATABASE $MYSQL_DATABASE;"
#
#mysql -e "GRANT ALL PRIVILEGES ON *.* TO '$MYSQL_USER'@'%' IDENTIFIED BY '$MYSQL_USER_PASS' WITH GRANT OPTION;"
#
#mysql -e "FLUSH PRIVILEGES;"
#
#mysqld 	--init-file=/change_root_pass
#
#else
#	echo database is already present, creation step skipped
#	mysqld
#fi

#service mysql stop

#kill $(cat /var/run/mysqld/mysqld.pid)

#mysqld
#tail -f /dev/null
