#!/bin/bash

mkdir -p /run/mysqld && chown -R mysql:mysql /run/mysqld

mysqld &

sleep 3

mysql -uroot -p$MYSQL_ROOT_PASS -e "CREATE DATABASE $MYSQL_DATABASE;"

mysql -uroot -p$MYSQL_ROOT_PASS -e "GRANT ALL PRIVILEGES ON *.* TO '$MYSQL_USER'@'%' IDENTIFIED BY '$MYSQL_USER_PASS' WITH GRANT OPTION;"

mysql -uroot -p$MYSQL_ROOT_PASS -e "SET PASSWORD FOR 'root'@'localhost' = PASSWORD('$MYSQL_ROOT_PASS');"

mysql -uroot -p$MYSQL_ROOT_PASS -e "FLUSH PRIVILEGES;"

echo "root password set"

mysqladmin -uroot -p$MYSQL_ROOT_PASS shutdown

exec mysqld
