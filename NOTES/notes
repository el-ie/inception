
DESCRIPTION CHRONOLOGIQUE DU PROCESSUS

but : installer php fpm

faut il obligatoirement avoir NGINX pour l'utiliser ? Comment l'installer avec l'image du hub ?

php fpm (FastCGI Process Manager):
SAPI (server application programming interface)

" Dans le cas présent, le SAPI (Server API) mod_php est utilisé pour exécuter le
  code PHP dans le serveur web Apache. Le SAPI mod_php permet à Apache de communiquer
  avec PHP et d'exécuter des scripts PHP pour générer des pages web dynamiques. "

mod_php :
" Cela permet de gagner en performance en évitant les coûts liés à la communication
  entre Apache et PHP via une interface CGI ou FastCGI. "

php fpm :
"PHP-FPM est une alternative au SAPI mod_php qui offre une meilleure isolation des 
processus PHP et une gestion plus efficace des ressources système. :


selon chatgpt le sapi de base de l'image utilisee est celui fourni avec apache : mod_php

php -i | grep "Server API"
reponse actuelle :
Server API => Command Line Interface (*commande inutile)
chatgpt: cela signifie que PHP est exécuté en mode CLI (Command Line Interface) et que le serveur web n'est pas utilisé

je test la presence du SAPI :
echo "<?php phpinfo();" > /var/www/html/test.php
je peux acceder a http://localhost:8080/test.php sur le navigateur et donc je vois que le php est fonctionnel
on peuet voir dans le tableau : Server API 	Apache 2.0 Handler 
(bizarre vu que Server API => Command Line Interface)

______

tuto :
https://bobcares.com/blog/docker-compose-nginx-php-fpm-mysql-wordpress/ ->> SUCCESS

on a bien wordpress qui fonctionne avec php fmp et nginx en verifiant la page test.php rajoutee

Maintenant on a la syntaxe "links:" du docker-compose a enlever car elle est interdite
et on va essayer de remplacer ca par un network

succes ! Link a ete enleve et bien remplace par network


		8 avril

Enfait on peut faire tourner nginx seul et acceder a une page html (customizee) sur
firefox en localhost
(dockerfile : COPY nginx.conf /etc/nginx/nginx.conf - COPY site /var/www/html
avec nginx.conf :
events {@    worker_connections 1024;@}@@http {@    server {@        listen 80;@@        location / {@            root /var/www/html;@            index index.html;@        }@    }@}@



-----------------------------------------------------------------------------------
-----------------------------------------------------------------------------------
-----------------------------------------------------------------------------------

PISTES

changer mod_php par php fpm dans l'image actuelle

regarder les "Supported tags and respective Dockerfile links" puis reutiliser les Dockerfile correspondant

arreter docker compose et lancer les images dans des terminaux directement

Exactement, l'image Docker wordpress:cli ne contient pas WordPress, elle ne contient que WP-CLI et quelques autres outils nécessaires pour exécuter WP-CLI. Pour utiliser WP-CLI, vous devez avoir une installation de WordPress fonctionnelle à partir de laquelle vous pouvez exécuter les commandes WP-CLI.

si besoin : image wordpress:fpm (wordpress - php fpm - nginx) ??

		8 avril

regarder le vrai Dockerfile de nginx
entry point ?
enlever le dockerfile du folder nginx car il est copie dans l image

google LEMP stack (linux/enginex/mariadb/php)

-----------------------------------------------------------------------------------
-----------------------------------------------------------------------------------

QUESTIONNEMENT

l'image de wordpress tourne avec apache, ne faudrait il pas plutot que j'utilise une image de wordpress sans 
serveur et un container separe avec le server

y a t il une image de wordpress sans apache ?

faut il utiliser apt(-get) upgrade dans les vm

y aura t il des restrictions de versions sur les paquets a installer

vaut il mieux installer wordpress avec apt ou directement le telecharger par une requete ? 
(apt installe plein de choses en plus avec wordpress tel que apache etc pour faire une LAMP)

" Par défaut, l'installation de WordPress via "apt" configure un serveur Apache avec un hôte virtuel pour votre site WordPress. "

----------------------------------------------------------------------------------
-----------------------------------------------------------------------------------

OUTILS

hub docker : Supported tags and respective Dockerfile links
en cliquant sur les differentes versions de l'image on peut voir le dockerfile correspondant avec toutes les 
etapes de creation de l'image

reseau :
" Lorsque vous utilisez docker-compose, il gère automatiquement les liens entre
  les différents services et crée un réseau Docker par défaut pour les connecter.
  Cela signifie que vous n'avez pas à vous soucier de la configuration de la 
  communication entre les différents conteneurs. "

-----------------------------------------------------------------------------------

COMMANDES

docker-compose down
supprime les containers en cours et + (tous ceux visibles avec ps et ceux visibles avec ps -a), approfondir

docker network ls
docker network inspect

docker network prune
supprime les network inutilises de docker

docker-compose config
check certains problemes dans le docker-compose.yml

CREER LES CONTAINERS EN INTERACTIF :

docker network create resoso
docker run --name ctn_1 --network resoso -it debian:buster bash
docker run --name ctn_2 --network resoso -it debian:buster bash

verifier la connection entre 2 container : on peut ping un container a partir d'un autre

service ... status
service ... start

-----------------------------------------------------------------------------------
-----------------------------------------------------------------------------------



APACHE

root@39236095b640:/# apachectl configtest
AH00558: apache2: Could not reliably determine the server's fully qualified domain name, using 172.20.0.3. Set the 'ServerName' directive globally to suppress this message

apachectl -V
affiche toutes les informations importantes de l'apache utilise



-----------------------------------------------------------------------------------

WORDPRESS

wordpress utilise ce user :
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
il faut donc adapter ses droits

dans le dossier wordpress il y a un bon exemple de config :
wp-config-sample.php


-----------------------------------------------------------------------------------

DOCKER

RESEAUX DOCKER

Il existe différents types de réseaux Docker, notamment :

    Bridge : le réseau par défaut de Docker qui permet aux conteneurs de communiquer entre eux sur le même hôte.

    Host : un réseau qui connecte les conteneurs directement à l'interface réseau de l'hôte. Cela permet aux conteneurs d'utiliser les mêmes ports que l'hôte.

    Overlay : un réseau qui permet à des conteneurs de communiquer entre eux sur plusieurs hôtes.

    Macvlan : un réseau qui permet à un conteneur d'obtenir une adresse IP sur le réseau physique.

    None : un réseau qui désactive le réseau pour le conteneur.

COPY VS VOLUME : gpt
	(COPY de Dockerfile vs volume de docker-compose.yml)
	En résumé:
 " COPY est utilisé pour inclure des fichiers statiques dans une image Docker lors de la construction, 
   tandis que volumes est utilisé pour monter des fichiers et des répertoires depuis l'hôte vers un conteneur
   Docker en cours d'exécution.
   Les fichiers copiés avec COPY sont intégrés dans l'image Docker, alors que les fichiers et répertoires 
   montés avec volumes sont partagés entre l'hôte et le conteneur en temps réel. "

lancer un container en fesant qu'il ne s'arrete pas directement:
docker -d debian:buster tail -f /dev/null

------------------------------------------------------------------------------------

MARIADB

je pense qu'il ne faut pas installer le paquet mysql

mysqladmin version
donnes des infos

$mysql -> ouvre le prompt de mariadb (sans le $)

*
tuto installation
https://www.digitalocean.com/community/tutorials/how-to-install-mariadb-on-ubuntu-20-04

gestion de mariadb :
https://mariadb.com/kb/en/sysvinit/

---------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------

	PHP-FPM

Le module PHP-FPM permet la communication entre le serveur Nginx et PHP, basée sur le protocole FastCGI. Ce module, écoutant sur le port 9000 par défaut ou sur un socket UNIX, permet notamment l’exécution de scripts PHP dans un processus indépendant de Nginx avec des UID et GID différents. Il sera alors possible, dans le cas de la gestion de plusieurs applications sur un même serveur, de créer et configurer un groupe (appelé aussi pool) par application. Un pool définit notamment le UID/GID des processus PHP et le nombre de processus minimum, maximum ou encore le nombre de processus en attente à lancer.

===============================================================================

	10 avril

tout dans un conteneur

apt-get update -y

mkdir -p /srv/www (test)
wget https://wordpress.org/latest.tar.gz

tar xzf latest.tar.gz -C /srv/www/

chown -R www-data /srv/www
chmod -R 777 /srv

	je n ai pas installe php

apt-get install mariadb-server -y
apt-get install systemd -y

systemctl enable mariadb.service
n'a pas corrige le probleme, utile quand meme ?

probleme systemctl : https://stackoverflow.com/questions/59466250/docker-system-has-not-been-booted-with-systemd-as-init-system

systemctl replacement to test :
https://github.com/gdraheim/docker-systemctl-replacement
wget https://raw.githubusercontent.com/gdraheim/docker-systemctl-replacement/master/files/docker/systemctl.py -O /usr/local/bin/systemctl

service mysql start
SUCCESS (lance mariadb) utilise sysvinit et non systemd





	NON FAIT :
installation php
# apt-get install php7.2 php7.2-cli php7.2-fpm php7.2-mysql php7.2-json php7.2-opcache php7.2-mbstring php7.2-xml php7.2-gd php7.2-curl
OU sudo apt-get -y install php-cli php-mysql php-curl php-gd php-intl

creation du "pool" pour php fpm
/etc/php/7.4/fpm/pool.d/blog.conf
